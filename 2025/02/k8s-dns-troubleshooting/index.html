<!doctype html><html lang=en-us x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Kubernetes DNS Troubleshooting: When Pods Can't Access External Domains | AI Solve</title>
<link href=/favicon.ico rel=icon type=image/x-icon><link rel=canonical href=https://jiejue.ai/2025/02/k8s-dns-troubleshooting/><meta name=author content="Dong Hao"><meta name=description content="On a regular workday, the development team encountered an unusual issue: a Pod in the Kubernetes cluster suddenly couldn&rsquo;t access external domains. While this problem seemed simple at first, it involved multiple aspects including Kubernetes DNS, Azure Private DNS, and service discovery. Let&rsquo;s explore how to diagnose and solve this issue.
"><meta name=keywords content><meta name=generator content="Hugo 0.144.2"><meta property="og:url" content="https://jiejue.ai/2025/02/k8s-dns-troubleshooting/"><meta property="og:site_name" content="AI Solve"><meta property="og:title" content="Kubernetes DNS Troubleshooting: When Pods Can't Access External Domains"><meta property="og:description" content="On a regular workday, the development team encountered an unusual issue: a Pod in the Kubernetes cluster suddenly couldn’t access external domains. While this problem seemed simple at first, it involved multiple aspects including Kubernetes DNS, Azure Private DNS, and service discovery. Let’s explore how to diagnose and solve this issue."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-01T08:50:37+04:00"><meta property="article:modified_time" content="2025-02-21T10:56:16+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kubernetes DNS Troubleshooting: When Pods Can't Access External Domains"><meta name=twitter:description content="On a regular workday, the development team encountered an unusual issue: a Pod in the Kubernetes cluster suddenly couldn’t access external domains. While this problem seemed simple at first, it involved multiple aspects including Kubernetes DNS, Azure Private DNS, and service discovery. Let’s explore how to diagnose and solve this issue."><link rel=stylesheet href=/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav x-data="{ isSticky: false }" x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })" class="sticky top-0 z-30 mt-4 lg:mt-8 py-4" :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:online" @click="flip = !flip" title="Flip it!"><div class="h-10 rounded-full"><img src=/favicon.ico alt="AI Solve"></div></div><div><a href=https://jiejue.ai/ class="text-lg font-semibold cursor-pointer">AI Solve</a><div class="text-base-content/60 text-sm">Using AI to Serve People</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/index.xml title=RSS><ion-icon class=group-hover:text-primary-content name=logo-rss></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/posts title=Archives><ion-icon class=group-hover:text-primary-content name=archive></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/tags title="All Tags"><ion-icon class=group-hover:text-primary-content name=pricetags></ion-icon></a></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4"><div class="hidden lg:block"></div><div class=lg:col-span-2><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="Kubernetes DNS Troubleshooting: When Pods Can't Access External Domains"><meta itemprop=description content="On a regular workday, the development team encountered an unusual issue: a Pod in the Kubernetes cluster suddenly couldn’t access external domains. While this problem seemed simple at first, it involved multiple aspects including Kubernetes DNS, Azure Private DNS, and service discovery. Let’s explore how to diagnose and solve this issue."><meta itemprop=datePublished content="2025-02-01T08:50:37+04:00"><meta itemprop=dateModified content="2025-02-21T10:56:16+05:30"><meta itemprop=wordCount content="712"><header><h1 itemprop=headline>Kubernetes DNS Troubleshooting: When Pods Can't Access External Domains</h1><p class=text-sm><span data-format=luxon>2025-02-01T08:50:37+04:00</span>
| <span>4 minute read</span>
| <span>Updated at
<span data-format=luxon>2025-02-21T10:56:16+05:30</span></span></p><div class="flex justify-between"><div class="flex items-center"><span>@</span>
<span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>Dong Hao</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=Kubernetes%20DNS%20Troubleshooting:%20When%20Pods%20Can%27t%20Access%20External%20Domains&amp;url=https://jiejue.ai/2025/02/k8s-dns-troubleshooting/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https://jiejue.ai/2025/02/k8s-dns-troubleshooting/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://wa.me/?text=Kubernetes%20DNS%20Troubleshooting:%20When%20Pods%20Can%27t%20Access%20External%20Domains%20https://jiejue.ai/2025/02/k8s-dns-troubleshooting/" target=_blank rel="noopener noreferrer" title="Share on WhatsApp"><ion-icon class=group-hover:text-primary-content name=logo-whatsapp></ion-icon></a></div></div></header><section id=dream-single-post-content itemprop=articleBody><img src=https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250201085756908.webp alt="Kubernetes DNS Troubleshooting: When Pods Can't Access External Domains"><p>On a regular workday, the development team encountered an unusual issue: a Pod in the Kubernetes cluster suddenly couldn&rsquo;t access external domains. While this problem seemed simple at first, it involved multiple aspects including Kubernetes DNS, Azure Private DNS, and service discovery. Let&rsquo;s explore how to diagnose and solve this issue.</p><h2 id=problem-description>Problem Description</h2><p>Developers discovered that when trying to access external domains from within a Pod, they encountered DNS resolution failures:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl https://product-service-test.jiejue.ai
</span></span><span style=display:flex><span>curl: <span style=color:#f92672>(</span>6<span style=color:#f92672>)</span> Could not resolve host:product-service-test.jiejue.ai
</span></span></code></pre></div><h2 id=deep-investigation>Deep Investigation</h2><h3 id=step-1-verify-dns-query>Step 1: Verify DNS Query</h3><p>First, we used the <code>nslookup</code> command to check domain resolution:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nslookupproduct-service-test.jiejue.ai
</span></span><span style=display:flex><span>Server:         10.0.0.10
</span></span><span style=display:flex><span>Address:        10.0.0.10:53
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>** server can<span style=color:#960050;background-color:#1e0010>&#39;</span>t findproduct-service-test.jiejue.ai: NXDOMAIN
</span></span></code></pre></div><p>Here we found our first key information: the default DNS server is <code>10.0.0.10</code>, and it returned an NXDOMAIN (domain doesn&rsquo;t exist) error.</p><h3 id=step-2-try-alternative-dns-servers>Step 2: Try Alternative DNS Servers</h3><p>Next, we tried using a public DNS server (like Cloudflare&rsquo;s 1.1.1.1):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ nslookupproduct-service-test.jiejue.ai 1.1.1.1
</span></span><span style=display:flex><span>Server:         1.1.1.1
</span></span><span style=display:flex><span>Address:        1.1.1.1:53
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Non-authoritative answer:
</span></span><span style=display:flex><span>Name:  product-service-test.jiejue.ai
</span></span><span style=display:flex><span>Address: 21.274.30.143
</span></span></code></pre></div><p>Interestingly, using a public DNS server resolved the domain correctly! This indicated that the problem wasn&rsquo;t with the domain itself, but with the cluster&rsquo;s DNS configuration.</p><h3 id=step-3-analyze-dns-query-process-in-detail>Step 3: Analyze DNS Query Process in Detail</h3><p>Using the <code>dig</code> command to get more detailed DNS query information:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ dig @10.0.0.10product-service-test.jiejue.ai
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>;; AUTHORITY SECTION:
</span></span><span style=display:flex><span>core42.co.    <span style=color:#ae81ff>10</span>    IN    SOA    azureprivatedns.net. azureprivatedns-host.microsoft.com. <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3600</span> <span style=color:#ae81ff>300</span> <span style=color:#ae81ff>2419200</span> <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p>Here we discovered the root cause: <code>core42.co</code> domain was defined in Azure Private DNS Zones! This explained why the cluster&rsquo;s DNS server couldn&rsquo;t resolve this domain.</p><h2 id=root-cause>Root Cause</h2><p>When we create a Private DNS Zone in Azure, even if it only has one SOA (Start of Authority) record, it takes over the resolution authority for the entire domain. This means:</p><ol><li>All DNS queries for <code>*.jiejue.ai</code> are routed to Azure Private DNS</li><li>If no matching record is found in the Private DNS Zone, the query fails</li><li>The DNS server won&rsquo;t query external DNS servers anymore</li></ol><p>It&rsquo;s like saying &ldquo;I&rsquo;m in charge of this domain!&rdquo; but not actually having any resolution records configured.</p><h2 id=solutions>Solutions</h2><p>There are two possible solutions:</p><ol><li><p>If the domain needs to be accessed through the public internet:</p><ul><li>Delete the <code>core42.co</code> record from Azure Private DNS Zone</li><li>Or keep only specific subdomains (like <code>internal.core42.co</code>) for internal services</li></ul></li><li><p>If this is an internal service:</p><ul><li>Add corresponding DNS records in the Azure Private DNS Zone</li><li>Ensure records point to correct internal IP addresses</li></ul></li></ol><h2 id=extended-knowledge-kubernetes-service-discovery>Extended Knowledge: Kubernetes Service Discovery</h2><p>During troubleshooting, we discovered an even better solution. Since the target service was actually deployed in the same Kubernetes cluster, we could use Kubernetes&rsquo; service discovery mechanism to access it.</p><p>Kubernetes provides a unified service discovery format:</p><pre tabindex=0><code>&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local
</code></pre><p>For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl http://api-service.frontend.svc.cluster.local
</span></span></code></pre></div><p>This approach has several important advantages:</p><ol><li><strong>Reliability</strong>: No dependency on external DNS resolution</li><li><strong>Security</strong>: Internal cluster communication, no need to go through public internet</li><li><strong>Performance</strong>: Direct use of internal cluster network</li><li><strong>Consistency</strong>: Standard format in any Kubernetes cluster</li></ol><h2 id=best-practice-recommendations>Best Practice Recommendations</h2><ol><li><p><strong>DNS Configuration Management</strong>:</p><ul><li>When using Azure Private DNS Zone, clearly plan which domains are for internal services</li><li>Avoid creating records in Private DNS Zone that might conflict with public domains</li></ul></li><li><p><strong>Service Access Strategy</strong>:</p><ul><li>Prioritize using Kubernetes service discovery for cluster-internal services</li><li>Use dedicated internal domains (like <code>.internal.company.com</code>) for internal services</li><li>Use CoreDNS custom configuration to handle special DNS requirements</li></ul></li><li><p><strong>Troubleshooting Process</strong>:</p><ul><li>Use tools like <code>nslookup</code> and <code>dig</code> to collect detailed information</li><li>Check response differences between different DNS servers</li><li>Review DNS configuration and cloud provider settings</li></ul></li></ol><h2 id=important-notes>Important Notes</h2><p>In practice, also keep in mind:</p><ol><li>Modifying DNS configuration can affect network communication across the entire cluster</li><li>Test DNS setting changes in a test environment before applying to production</li><li>Maintain good documentation, including DNS configuration change history</li></ol><p>Through this troubleshooting experience, we not only solved the specific problem but also deepened our understanding of Kubernetes networking and DNS resolution mechanisms. This knowledge will be helpful in daily operations and problem-solving.</p><h2 id=technical-diagram>Technical Diagram</h2><p>Here&rsquo;s a diagram showing the DNS resolution process and Kubernetes service discovery mechanism.</p><pre class=mermaid>graph TB
    Pod[Pod] --> CoreDNS[CoreDNS\n10.0.0.10]
    CoreDNS --> PrivateDNS[Azure Private DNS\ncore42.co]
    CoreDNS --> PublicDNS[Public DNS\n1.1.1.1]
    CoreDNS --> K8sService[Kubernetes Service\nbackend.portal.svc.cluster.local]
  
    style Pod fill:#e1f5fe
    style CoreDNS fill:#b3e5fc
    style PrivateDNS fill:#81d4fa
    style PublicDNS fill:#4fc3f7
    style K8sService fill:#29b6f6</pre><p>I hope this article helps you understand and solve DNS issues in Kubernetes. If you have any questions, feel free to discuss in the comments!</p></section><div class=divider></div><div class="flex flex-col md:flex-row justify-between gap-4 py-4"><a class="group btn btn-outline" href=/2025/02/hugo-show-all-posts-in-homepage/ title="How to Display All Posts on the Homepage of Your Hugo Theme"><ion-icon name=chevron-back></ion-icon><div class="inline-flex flex-col items-start"><span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">Previous page</span>
<span class="max-w-48 truncate">How to Display All Posts on the Homepage of Your Hugo Theme</span></div></a><a class="group btn btn-outline" href=/2025/01/three-stages-of-ai-revolution/ title="The Three Stages of AI Revolution from a Productivity Perspective"><div class="inline-flex flex-col items-end"><span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">Next page</span>
<span class="max-w-48 truncate">The Three Stages of AI Revolution from a Productivity Perspective</span></div><ion-icon name=chevron-forward></ion-icon></a></div></article></div><div class="hidden lg:flex lg:flex-col lg:items-end"><nav id=TableOfContents><ul><li><a href=#problem-description>Problem Description</a></li><li><a href=#deep-investigation>Deep Investigation</a><ul><li><a href=#step-1-verify-dns-query>Step 1: Verify DNS Query</a></li><li><a href=#step-2-try-alternative-dns-servers>Step 2: Try Alternative DNS Servers</a></li><li><a href=#step-3-analyze-dns-query-process-in-detail>Step 3: Analyze DNS Query Process in Detail</a></li></ul></li><li><a href=#root-cause>Root Cause</a></li><li><a href=#solutions>Solutions</a></li><li><a href=#extended-knowledge-kubernetes-service-discovery>Extended Knowledge: Kubernetes Service Discovery</a></li><li><a href=#best-practice-recommendations>Best Practice Recommendations</a></li><li><a href=#important-notes>Important Notes</a></li><li><a href=#technical-diagram>Technical Diagram</a></li></ul></nav></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>© 2025 AI Solve</p><p>Silicon-based Life Kindergarten</p></div><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><section><span id=busuanzi_container_value_site_pv><i class="far fa-eye fa-fw"></i>
Site Total Visits <span id=busuanzi_value_site_pv></span>
</span>&nbsp;|&nbsp;
<span id=busuanzi_container_value_site_uv><i class="fa fa-user"></i>
Site Visitor Count <span id=busuanzi_value_site_uv></span></span></section></span></section></script><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="dream-grid dream-grid-about"></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>© 2025 AI Solve</p><p>Silicon-based Life Kindergarten</p></div><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><section><span id=busuanzi_container_value_site_pv><i class="far fa-eye fa-fw"></i>
Site Total Visits <span id=busuanzi_value_site_pv></span>
</span>&nbsp;|&nbsp;
<span id=busuanzi_container_value_site_uv><i class="fa fa-user"></i>
Site Visitor Count <span id=busuanzi_value_site_uv></span></span></section></span></section></script><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin=anonymous></script><script src=/js/grid.min.js></script><script src=/js/main.min.js></script><script src=https://cdn.jsdelivr.net/npm/luxon@1.26.0 integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=" crossorigin=anonymous></script><script>format();function format(){document.querySelectorAll('span[data-format="luxon"]').forEach(e=>{const t=e.textContent;e.textContent=luxon.DateTime.fromISO(t,{locale:"en"}).toFormat("yyyy-MM-dd HH:mm")})}</script><script type=module>
      import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
      mediumZoom('#dream-single-post-content img')
    </script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
      </script><script async src="https://www.googletagmanager.com/gtag/js?id=G-S0KCH9BW4F"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S0KCH9BW4F")}</script><script type=module src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js></script></body></html>